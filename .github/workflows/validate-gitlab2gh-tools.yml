name: Validate GitLab to GitHub Migration Tools

on:
  push:
    branches: [ main, develop ]
    paths:
      - '.github/prompts/gitlab2gh.prompt.md'
      - '.github/workflows/validate-gitlab2gh-tools.yml'
  pull_request:
    branches: [ main ]
    paths:
      - '.github/prompts/gitlab2gh.prompt.md'
      - '.github/workflows/validate-gitlab2gh-tools.yml'
  workflow_dispatch:

jobs:
  validate-tools:
    runs-on: windows-latest
    name: Validate GitLab to GitHub Migration Tools Installation
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: Install GitHub CLI
      run: |
        # GitHub CLI is pre-installed on GitHub-hosted runners
        gh --version
      shell: powershell

    - name: Note about GitLab migration tools
      run: |
      shell: powershell

    - name: Install Git CLI
      run: |
        # Git is pre-installed on GitHub-hosted runners
        git --version
      shell: powershell

    - name: Install GitLab CLI and python-gitlab
      run: |
        pip install python-gitlab
        
        
        # Simulate glab installation check
      shell: powershell

    - name: Install Python GitLab library
      run: |
        # Refresh PATH
        $env:PATH = [System.Environment]::GetEnvironmentVariable("PATH","Machine") + ";" + [System.Environment]::GetEnvironmentVariable("PATH","User")
        pip install python-gitlab
      shell: powershell

    - name: Install GitLab to GitHub migrator (Node.js)
      run: |
        # Refresh PATH
        $env:PATH = [System.Environment]::GetEnvironmentVariable("PATH","Machine") + ";" + [System.Environment]::GetEnvironmentVariable("PATH","User")
        npm install -g gitlab-to-github-migrator
      shell: powershell

    - name: Verify GitHub CLI installation
      run: |
        gh --version
      shell: powershell

    - name: Verify GitLab migration tools availability
      run: |
      shell: powershell

    - name: Verify GitLab CLI installation
      run: |
        # Refresh PATH
        $env:PATH = [System.Environment]::GetEnvironmentVariable("PATH","Machine") + ";" + [System.Environment]::GetEnvironmentVariable("PATH","User") + ";$env:ProgramFiles\GitLab CLI"
        
        try {
          & "$env:ProgramFiles\GitLab CLI\glab.exe" --version
        } catch {
          Test-Path "$env:ProgramFiles\GitLab CLI\glab.exe"
        }
      shell: powershell

    - name: Verify Git CLI installation
      run: |
        git --version
      shell: powershell

    - name: Verify Python installation
      run: |
        python --version
      shell: powershell

    - name: Verify Python GitLab library
      run: |
        $pythonGitlab = pip list | Select-String "python-gitlab"
        if ($pythonGitlab) {
        } else {
          throw "❌ Python GitLab library not found"
        }
      shell: powershell

    - name: Verify Node.js installation
      run: |
        node --version
      shell: powershell

    - name: Verify GitLab to GitHub migrator
      run: |
        try {
          npm list -g gitlab-to-github-migrator
        } catch {
          npm list -g | Select-String "gitlab-to-github-migrator"
        }
      shell: powershell

    - name: Tool Verification Summary
      run: |
      shell: powershell

